const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/C09ilbkJ.js","../chunks/C465rxuw.js","../chunks/CB_tPkvo.js","../chunks/whYGBSIx.js","../chunks/DZQvN3bd.js","../chunks/CE7aw2fd.js","../chunks/Bi71H8rS.js","../chunks/CmQ9brEP.js","../chunks/D4nvVtgN.js"])))=>i.map(i=>d[i]);
import{p as u,c as Ee,s as Wt,a as oo,_ as ro,b as Ut}from"../chunks/DZQvN3bd.js";import{e as j,a as q,f as Q,c as qe,m as no}from"../chunks/C465rxuw.js";import{i as je}from"../chunks/DcQ328Ue.js";import{w as ao,a as Rt,g as io,o as so}from"../chunks/whYGBSIx.js";import{h as Xe,a as Kt,b as lo,z as e,r as co,H as uo,s as Xt,c as It,d as At,k as pt,R as vo,ah as fo,a2 as qt,e as go,j as Nt,b8 as ho,l as po,aB as ce,aY as bo,af as zt,b9 as mo,P as Yt,ba as xo,bb as yo,as as C,a9 as _o,i as Ct,bc as Re,bd as Zt,f as Qt,p as jt,be as Pt,q as wo,bf as So,bg as ko,ae as Mo,g as Io,ab as Ao,I as Ne,bh as X,ar as x,A as z,bi as $e,K as f,M,L as v,G as ge,J as He,D as ye,u as O,F as xt,bj as Co}from"../chunks/CB_tPkvo.js";import{i as ke}from"../chunks/BxMNj1IZ.js";import{b as Ze,a as _e,s as ve,r as Tt,c as Dt,h as Po}from"../chunks/CmQ9brEP.js";import{s as To,g as Do}from"../chunks/C_Vu7wBe.js";import{s as de}from"../chunks/BfsXbONn.js";import{t as We,a as Lt,f as Ht,s as Lo,b as Vt,c as Eo}from"../chunks/DPfRY17x.js";function Ro(o,t,s){for(var h=[],y=t.length,d,r=t.length,w=0;w<y;w++){let P=t[w];jt(P,()=>{if(d){if(d.pending.delete(P),d.done.add(P),d.pending.size===0){var S=o.outrogroups;Ot(zt(d.done)),S.delete(d),S.size===0&&(o.outrogroups=null)}}else r-=1},!1)}if(r===0){var c=h.length===0&&s!==null;if(c){var p=s,l=p.parentNode;Mo(l),l.append(p),o.items.clear()}Ot(t,!c)}else d={pending:new Set(t),done:new Set},(o.outrogroups??=new Set).add(d)}function Ot(o,t=!0){for(var s=0;s<o.length;s++)Io(o[s],t)}var Jt;function yt(o,t,s,h,y,d=null){var r=o,w=new Map,c=(t&Zt)!==0;if(c){var p=o;r=Xe?It(_o(p)):p.appendChild(Ct())}Xe&&Kt();var l=null,P=ce(()=>{var i=s();return bo(i)?i:i==null?[]:zt(i)}),S,T=!0;function E(){n.fallback=l,No(n,S,r,t,h),l!==null&&(S.length===0?(l.f&Re)===0?Qt(l):(l.f^=Re,ct(l,null,r)):jt(l,()=>{l=null}))}var F=lo(()=>{S=e(P);var i=S.length;let k=!1;if(Xe){var G=co(r)===uo;G!==(i===0)&&(r=Xt(),It(r),At(!1),k=!0)}for(var A=new Set,R=go,N=po(),I=0;I<i;I+=1){Xe&&pt.nodeType===vo&&pt.data===fo&&(r=pt,k=!0,At(!1));var B=S[I],W=h(B,I),_=T?null:w.get(W);_?(_.v&&qt(_.v,B),_.i&&qt(_.i,I),N&&R.unskip_effect(_.e)):(_=Ho(w,T?r:Jt??=Ct(),B,W,I,y,t,s),T||(_.e.f|=Re),w.set(W,_)),A.add(W)}if(i===0&&d&&!l&&(T?l=Nt(()=>d(r)):(l=Nt(()=>d(Jt??=Ct())),l.f|=Re)),i>A.size&&ho(),Xe&&i>0&&It(Xt()),!T)if(N){for(const[Z,V]of w)A.has(Z)||R.skip_effect(V.e);R.oncommit(E),R.ondiscard(()=>{})}else E();k&&At(!0),e(P)}),n={effect:F,items:w,outrogroups:null,fallback:l};T=!1,Xe&&(r=pt)}function dt(o){for(;o!==null&&(o.f&So)===0;)o=o.next;return o}function No(o,t,s,h,y){var d=(h&ko)!==0,r=t.length,w=o.items,c=dt(o.effect.first),p,l=null,P,S=[],T=[],E,F,n,i;if(d)for(i=0;i<r;i+=1)E=t[i],F=y(E,i),n=w.get(F).e,(n.f&Re)===0&&(n.nodes?.a?.measure(),(P??=new Set).add(n));for(i=0;i<r;i+=1){if(E=t[i],F=y(E,i),n=w.get(F).e,o.outrogroups!==null)for(const _ of o.outrogroups)_.pending.delete(n),_.done.delete(n);if((n.f&Re)!==0)if(n.f^=Re,n===c)ct(n,null,s);else{var k=l?l.next:c;n===o.effect.last&&(o.effect.last=n.prev),n.prev&&(n.prev.next=n.next),n.next&&(n.next.prev=n.prev),Fe(o,l,n),Fe(o,n,k),ct(n,k,s),l=n,S=[],T=[],c=dt(l.next);continue}if((n.f&Pt)!==0&&(Qt(n),d&&(n.nodes?.a?.unfix(),(P??=new Set).delete(n))),n!==c){if(p!==void 0&&p.has(n)){if(S.length<T.length){var G=T[0],A;l=G.prev;var R=S[0],N=S[S.length-1];for(A=0;A<S.length;A+=1)ct(S[A],G,s);for(A=0;A<T.length;A+=1)p.delete(T[A]);Fe(o,R.prev,N.next),Fe(o,l,R),Fe(o,N,G),c=G,l=N,i-=1,S=[],T=[]}else p.delete(n),ct(n,c,s),Fe(o,n.prev,n.next),Fe(o,n,l===null?o.effect.first:l.next),Fe(o,l,n),l=n;continue}for(S=[],T=[];c!==null&&c!==n;)(p??=new Set).add(c),T.push(c),c=dt(c.next);if(c===null)continue}(n.f&Re)===0&&S.push(n),l=n,c=dt(n.next)}if(o.outrogroups!==null){for(const _ of o.outrogroups)_.pending.size===0&&(Ot(zt(_.done)),o.outrogroups?.delete(_));o.outrogroups.size===0&&(o.outrogroups=null)}if(c!==null||p!==void 0){var I=[];if(p!==void 0)for(n of p)(n.f&Pt)===0&&I.push(n);for(;c!==null;)(c.f&Pt)===0&&c!==o.fallback&&I.push(c),c=dt(c.next);var B=I.length;if(B>0){var W=(h&Zt)!==0&&r===0?s:null;if(d){for(i=0;i<B;i+=1)I[i].nodes?.a?.measure();for(i=0;i<B;i+=1)I[i].nodes?.a?.fix()}Ro(o,I,W)}}d&&wo(()=>{if(P!==void 0)for(n of P)n.nodes?.a?.apply()})}function Ho(o,t,s,h,y,d,r,w){var c=(r&xo)!==0?(r&yo)===0?C(s,!1,!1):Yt(s):null,p=(r&mo)!==0?Yt(y):null;return{v:c,i:p,e:Nt(()=>(d(t,c??s,p??y,w),()=>{o.delete(h)}))}}function ct(o,t,s){if(o.nodes)for(var h=o.nodes.start,y=o.nodes.end,d=t&&(t.f&Re)===0?t.nodes.start:s;h!==null;){var r=Ao(h);if(d.before(h),h===y)return;h=r}}function Fe(o,t,s){t===null?o.effect.first=s:t.next=s,s===null?o.effect.last=t:s.prev=t}function bt(o,t,s,h,y){Xe&&Kt();var d=t.$$slots?.[s],r=!1;d===!0&&(d=t[s==="default"?"children":s],r=!0),d===void 0||d(o,r?()=>h:h)}const Oo=!1,Hr=Object.freeze(Object.defineProperty({__proto__:null,ssr:Oo},Symbol.toStringTag,{value:"Module"})),zo=()=>{const o=To;return{page:{subscribe:o.page.subscribe},navigating:{subscribe:o.navigating.subscribe},updated:o.updated}},Fo={subscribe(o){return zo().page.subscribe(o)}};function Qe(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`id_${Math.random().toString(16).slice(2)}_${Date.now()}`}const Ft=300;function $t(o,t=Ft){const s={widthMm:88,heightMm:107},h=6,y=3;let d=3,r=3;o==="2x3"&&(d=2,r=3);const w=s.widthMm-h*2-y*(r-1),c=s.heightMm-h*2-y*(d-1),p=w/r,l=c/d;return{id:"polaroid",name:"Polaroid",unit:"mm",dpi:t,stage:s,grid:{type:o,rows:d,cols:r,gapMm:y,marginMm:h,cellWidthMm:p,cellHeightMm:l}}}function mt(o,t){return o/25.4*t}function Bo(o,t){return o/t*25.4}function be(o){return Math.round(o*1e3)/1e3}function eo(o){const{marginMm:t,gapMm:s,rows:h,cols:y,cellWidthMm:d,cellHeightMm:r}=o.template.grid,w=[];for(let c=0;c<h;c++)for(let p=0;p<y;p++){const l=t+p*(d+s),P=t+c*(r+s);w.push({id:Qe(),xMm:be(l),yMm:be(P),widthMm:be(d),heightMm:be(r)})}return w}function Wo(){const o=$t("3x3",Ft),t={version:1,unit:"mm",dpi:o.dpi,template:o,slots:[],assets:{photos:[]},nodes:[],selected:{}};return t.slots=eo(t),t}function Uo(o){o.version=1,o.unit="mm",o.dpi=o.dpi||o.template?.dpi||Ft,o.template.dpi=o.dpi;const t=o.template.grid;if(!t.rows||!t.cols){const s=t.type||"3x3";o.template=$t(s,o.dpi)}(!Array.isArray(o.slots)||o.slots.length===0)&&(o.slots=eo(o)),o.assets||(o.assets={photos:[]}),Array.isArray(o.assets.photos)||(o.assets.photos=[]),Array.isArray(o.nodes)||(o.nodes=[]);for(const s of o.nodes)!s||typeof s!="object"||(s.type==="text"&&!s.origin&&(s.origin="topleft"),s.type==="photo"&&!s.origin&&(s.origin="center"),s.type==="emoji"&&!s.origin&&(s.origin="center"));return o.selected||(o.selected={}),o}function _t(o){return JSON.parse(JSON.stringify(o))}const Ye=ao(Wo());function Be(){let o;return Ye.subscribe(t=>o=t)(),_t(o)}function Ke(o){const t=typeof o=="string"?JSON.parse(o):o;Ye.set(Uo(_t(t)))}function Xo(o){const t=o.id??Qe();return Ye.update(s=>{const h=_t(s),y=h.assets.photos.findIndex(r=>r.id===t),d={id:t,name:o.name,src:o.src};return y>=0?h.assets.photos[y]=d:h.assets.photos.push(d),h}),t}function Se(o,t){Ye.update(s=>{const h=_t(s),y=h.nodes.findIndex(d=>d.id===o);return y<0?s:(h.nodes[y]={...h.nodes[y],...t},h)})}function Ce(o,t){Ye.update(s=>({...s,selected:{slotId:o,nodeId:t}}))}var qo=Q(`<div class="editor-shell min-h-screen w-full text-[var(--c-text)] svelte-100fcl5"><div class="editor-bg svelte-100fcl5"><header class="relative z-30 mx-auto flex max-w-[1440px] items-center gap-4 px-4 py-3 lg:px-6 svelte-100fcl5"><div class="flex items-center gap-2.5 svelte-100fcl5"><button class="rounded-xl border border-[var(--c-border-strong)] bg-white/80 px-3 py-2 text-xs font-semibold backdrop-blur transition hover:bg-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 svelte-100fcl5" type="button" aria-label="Voltar para tela inicial">← Voltar</button> <div class="hidden sm:flex items-center gap-2 svelte-100fcl5"><div class="grid h-8 w-8 place-items-center rounded-lg bg-[var(--c-accent)]/10 text-[var(--c-accent)] svelte-100fcl5"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true" class="svelte-100fcl5"><path d="M4 7a2 2 0 0 1 2-2h2l1-1h6l1 1h2a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7Z" stroke="currentColor" stroke-width="2" class="svelte-100fcl5"></path><path d="M8 14l2-2 2 2 3-3 3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-100fcl5"></path></svg></div> <div class="svelte-100fcl5"><div class="text-sm font-semibold leading-tight svelte-100fcl5">Polaroids</div> <div class="text-[11px] text-[var(--c-text-muted)] svelte-100fcl5">Pedido: <span class="font-mono font-semibold text-[var(--c-text)] svelte-100fcl5"> </span></div></div></div></div> <div class="ml-auto flex items-center gap-3 svelte-100fcl5"><span class="text-xs tabular-nums text-[var(--c-text-muted)] svelte-100fcl5"> </span> <div class="h-1.5 w-28 sm:w-40 overflow-hidden rounded-full bg-slate-200/60 svelte-100fcl5"><div class="h-full rounded-full bg-[var(--c-accent)] transition-all duration-300 svelte-100fcl5"></div></div></div></header> <main class="relative z-20 mx-auto grid max-w-[1440px] gap-4 px-4 pb-24 lg:px-6
        grid-cols-1 lg:grid-cols-[var(--sidebar-w)_1fr] svelte-100fcl5"><div class="relative z-30 svelte-100fcl5"><!></div> <div class="relative z-20 svelte-100fcl5"><!></div></main> <!></div></div>`);function Yo(o,t){Ne(t,!1);const s=C();let h=u(t,"orderId",8,""),y=u(t,"currentSlotIndex",8,0),d=u(t,"totalSlots",8,0),r=u(t,"onBack",8,()=>{});X(()=>(z(d()),z(y())),()=>{x(s,d()>0?Math.round((y()+1)/d()*100):0)}),$e();var w=qo(),c=f(w),p=f(c),l=f(p),P=f(l),S=M(P,2),T=M(f(S),2),E=M(f(T),2),F=M(f(E)),n=f(F,!0);v(F),v(E),v(T),v(S),v(l);var i=M(l,2),k=f(i),G=f(k);v(k);var A=M(k,2),R=f(A);v(A),v(i),v(p);var N=M(p,2),I=f(N),B=f(I);bt(B,t,"sidebar",{}),v(I);var W=M(I,2),_=f(W);bt(_,t,"canvas",{}),v(W),v(N);var Z=M(N,2);bt(Z,t,"bottombar",{}),v(c),v(w),ge(()=>{de(n,h()),de(G,`${y()+1} / ${d()??""}`),Ze(R,`width: ${e(s)??""}%`)}),j("click",P,function(...V){r()?.apply(this,V)}),We(1,i,()=>Lt,()=>({y:-4,duration:200})),We(1,p,()=>Ht,()=>({duration:200})),We(1,I,()=>Lt,()=>({x:-12,duration:240})),We(1,W,()=>Lt,()=>({x:12,duration:240})),q(o,w),He()}var Vo=Q('<span class="ml-auto rounded-md bg-slate-100 px-2 py-0.5 text-[11px] font-medium tabular-nums text-[var(--c-text-muted)]"> </span>'),Jo=Q('<div class="px-4 pb-4"><!></div>'),Go=Q('<div class="rounded-2xl border border-[var(--c-border)] bg-[var(--c-surface)] shadow-[var(--shadow-card)] backdrop-blur"><button type="button"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path></svg> <span class="text-sm font-semibold text-[var(--c-text)]"> </span> <!></button> <!></div>');function Et(o,t){let s=u(t,"title",8,""),h=u(t,"badge",8,""),y=u(t,"defaultOpen",8,!0),d=C(y());function r(){x(d,!e(d))}var w=Go(),c=f(w),p=f(c),l=M(p,2),P=f(l,!0);v(l);var S=M(l,2);{var T=n=>{var i=Vo(),k=f(i,!0);v(i),ge(()=>de(k,h())),q(n,i)};ke(S,n=>{h()&&n(T)})}v(c);var E=M(c,2);{var F=n=>{var i=Jo(),k=f(i);bt(k,t,"default",{}),v(i),We(3,i,()=>Lo,()=>({duration:180})),q(n,i)};ke(E,n=>{e(d)&&n(F)})}v(w),ge(()=>{_e(c,1,`flex w-full items-center gap-2 px-4 py-3 text-left transition hover:bg-white/50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-slate-400 ${e(d)?"rounded-t-2xl":"rounded-2xl"}`),ve(c,"aria-expanded",e(d)),_e(p,0,`shrink-0 text-[var(--c-text-muted)] transition-transform duration-200 ${e(d)?"rotate-90":""}`),de(P,s())}),j("click",c,r),q(o,w)}var Ko=Q('<div class="flex items-center gap-2 rounded-xl border border-[var(--c-border)] bg-slate-50 p-2"><span class="pl-1 text-xs font-medium text-[var(--c-text-muted)]"> </span> <div class="ml-auto flex items-center gap-1.5"><button class="rounded-lg bg-white px-3 py-1.5 text-xs font-semibold text-[var(--c-text)] border border-[var(--c-border)] transition hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400" type="button" aria-label="Duplicar fotos selecionadas">Duplicar</button> <button class="rounded-lg bg-white px-3 py-1.5 text-xs font-semibold text-[var(--c-text)] border border-[var(--c-border)] transition hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400" type="button" aria-label="Aplicar estilo às fotos selecionadas">Estilo</button> <button class="rounded-lg bg-[var(--c-danger)] px-3 py-1.5 text-xs font-semibold text-white transition hover:bg-[var(--c-danger-hover)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-400" type="button" aria-label="Deletar fotos selecionadas">Deletar</button></div></div>');function Zo(o,t){let s=u(t,"count",8,0),h=u(t,"onDelete",8,()=>{}),y=u(t,"onDuplicate",8,()=>{}),d=u(t,"onApplyStyle",8,()=>{});var r=qe(),w=ye(r);{var c=p=>{var l=Ko(),P=f(l),S=f(P);v(P);var T=M(P,2),E=f(T),F=M(E,2),n=M(F,2);v(T),v(l),ge(()=>de(S,`${s()??""} selecionada${s()>1?"s":""}`)),j("click",E,function(...i){y()?.apply(this,i)}),j("click",F,function(...i){d()?.apply(this,i)}),j("click",n,function(...i){h()?.apply(this,i)}),q(p,l)};ke(w,p=>{s()>0&&p(c)})}q(o,r)}var Qo=Q('<button type="button"> </button>'),jo=Q('<div class="flex flex-col items-center gap-2 rounded-xl border-2 border-dashed border-slate-200 bg-slate-50/50 py-8 text-center"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" class="text-slate-300" aria-hidden="true"><path d="M4 7a2 2 0 0 1 2-2h2l1-1h6l1 1h2a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7Z" stroke="currentColor" stroke-width="1.5"></path><path d="M8 14l2-2 2 2 3-3 3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg> <p class="text-sm text-[var(--c-text-faint)]">Envie suas fotos para começar</p></div>'),$o=no('<svg width="12" height="12" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M20 6 9 17l-5-5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>'),er=Q('<div class="h-3 w-3 rounded border-2 border-current"></div>'),tr=Q('<div><button class="block h-full w-full focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-[var(--c-accent)]" type="button"><img class="pointer-events-none h-full w-full object-cover" loading="lazy" draggable="false"/></button> <button type="button"><!></button> <button class="absolute right-1 top-1 z-10 grid h-6 w-6 place-items-center rounded-md bg-white/80 text-slate-500 opacity-0 shadow-sm backdrop-blur transition hover:bg-red-50 hover:text-red-500 group-hover:opacity-100 focus-visible:opacity-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-400" type="button" title="Remover"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M18 6 6 18M6 6l12 12" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"></path></svg></button> <span class="pointer-events-none absolute bottom-1 left-1 z-10 grid h-5 min-w-5 place-items-center rounded-md bg-black/50 px-1 text-[10px] font-semibold tabular-nums text-white"> </span></div>'),or=Q('<div class="grid grid-cols-4 gap-2"></div> <!>',1),rr=Q('<div class="space-y-3"><div class="flex items-center justify-between"><h3 class="text-xs font-semibold uppercase tracking-wider text-[var(--c-text-muted)]">Suas Fotos</h3> <!></div> <!></div>');function nr(o,t){Ne(t,!1);const s=C(),h=C();let y=u(t,"photos",24,()=>[]),d=u(t,"activePhotoAssetId",8,void 0),r=u(t,"selectedIds",24,()=>new Set),w=u(t,"onApply",8,()=>{}),c=u(t,"onRemove",8,()=>{}),p=u(t,"onToggleSelect",8,()=>{}),l=u(t,"onToggleSelectAll",8,()=>{}),P=u(t,"onDeleteSelected",8,()=>{}),S=u(t,"onDuplicateSelected",8,()=>{}),T=u(t,"onApplyStyleSelected",8,()=>{});X(()=>(z(y()),z(r())),()=>{x(s,y().length>0&&r().size===y().length)}),X(()=>z(r()),()=>{x(h,r().size===0)}),$e(),je();var E=rr(),F=f(E),n=M(f(F),2);{var i=R=>{var N=Qo(),I=f(N,!0);v(N),ge(()=>{_e(N,1,`rounded-lg px-2.5 py-1 text-xs font-medium transition
          ${e(s)?"bg-slate-900 text-white":"bg-slate-100 text-slate-600 hover:bg-slate-200"}
          focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400`),ve(N,"aria-label",e(s)?"Limpar seleção":"Selecionar tudo"),de(I,e(s)?"Limpar":"Selecionar tudo")}),j("click",N,function(...B){l()?.apply(this,B)}),q(R,N)};ke(n,R=>{z(y()),O(()=>y().length>0)&&R(i)})}v(F);var k=M(F,2);{var G=R=>{var N=jo();q(R,N)},A=R=>{var N=or(),I=ye(N);yt(I,7,y,W=>W.id,(W,_,Z)=>{const V=ce(()=>(z(r()),e(_),O(()=>r().has(e(_).id)))),re=ce(()=>(z(d()),e(_),O(()=>d()===e(_).id)));var ee=tr(),he=f(ee),Pe=f(he);v(he);var le=M(he,2),me=f(le);{var Te=ue=>{var De=$o();q(ue,De)},ie=ue=>{var De=er();q(ue,De)};ke(me,ue=>{e(V)?ue(Te):ue(ie,!1)})}v(le);var ne=M(le,2),Me=M(ne,2),xe=f(Me,!0);v(Me),v(ee),ge(()=>{_e(ee,1,`group relative aspect-square overflow-hidden rounded-xl border-2 transition-all
            ${e(re)?"border-[var(--c-accent)] shadow-[0_0_0_1px_var(--c-accent)]":"border-transparent hover:border-slate-300"}`),ve(he,"title",(e(_),z(e(Z)),O(()=>e(_).name??`Foto ${e(Z)+1}`))),ve(he,"aria-label",`Aplicar foto ${e(Z)+1} ao slot ativo`),ve(Pe,"src",(e(_),O(()=>e(_).src))),ve(Pe,"alt",(e(_),z(e(Z)),O(()=>e(_).name??`Foto ${e(Z)+1}`))),_e(le,1,`absolute left-1 top-1 z-10 grid h-6 w-6 place-items-center rounded-md transition
              ${e(V)?"bg-[var(--c-primary)] text-white shadow-sm":"bg-white/80 text-slate-500 opacity-0 shadow-sm backdrop-blur group-hover:opacity-100"}
              focus-visible:opacity-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400`),ve(le,"aria-label",e(V)?"Desmarcar foto":"Marcar foto"),ve(ne,"aria-label",`Remover foto ${e(Z)+1}`),de(xe,e(Z)+1)}),j("click",he,()=>w()(e(_).id)),j("click",le,Vt(()=>p()(e(_).id))),j("click",ne,Vt(()=>c()(e(_).id))),q(W,ee)}),v(I);var B=M(I,2);Zo(B,{get count(){return z(r()),O(()=>r().size)},get onDelete(){return P()},get onDuplicate(){return S()},get onApplyStyle(){return T()}}),q(R,N)};ke(k,R=>{z(y()),O(()=>y().length===0)?R(G):R(A,!1)})}v(E),q(o,E),He()}var ar=Q('<div class="rounded-xl border border-[var(--c-border)] bg-white p-3 space-y-2.5"><input class="w-full rounded-lg border border-[var(--c-border)] bg-slate-50 px-3 py-2 text-sm outline-none transition focus:border-slate-400 focus:bg-white focus:ring-1 focus:ring-slate-300" placeholder="Digite o texto..." aria-label="Conteúdo do texto"/> <div class="flex items-center gap-2"><label class="flex items-center gap-1.5 text-xs text-[var(--c-text-muted)]"><span>Tam.</span> <input class="w-14 rounded-md border border-[var(--c-border)] bg-slate-50 px-2 py-1 text-xs tabular-nums outline-none transition focus:border-slate-400 focus:ring-1 focus:ring-slate-300" type="number" aria-label="Tamanho da fonte em mm"/> <span>mm</span></label> <div class="ml-auto flex items-center gap-1"><input class="h-7 w-8 cursor-pointer rounded-md border border-[var(--c-border)] bg-white" type="color" aria-label="Cor do texto" title="Cor"/> <button type="button" title="Negrito">B</button> <button style="font-style: italic" type="button" title="Itálico">I</button></div></div></div>'),ir=Q(`<div class="space-y-3"><div class="flex items-center justify-between"><h3 class="text-xs font-semibold uppercase tracking-wider text-[var(--c-text-muted)]">Textos</h3> <span class="text-xs tabular-nums text-[var(--c-text-faint)]"> </span></div> <button class="w-full rounded-xl border border-dashed border-slate-300 bg-white px-3 py-2.5 text-sm font-medium text-[var(--c-text-muted)] transition
      enabled:hover:border-slate-400 enabled:hover:text-[var(--c-text)] disabled:opacity-40 disabled:cursor-not-allowed
      focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400" type="button" aria-label="Adicionar texto">+ Adicionar texto</button> <!></div>`);function sr(o,t){Ne(t,!1);let s=u(t,"textNodes",24,()=>[]),h=u(t,"maxTexts",8,4),y=u(t,"onAddText",8,()=>{});function d(n){const i=(n??"normal").toLowerCase();return{bold:i.includes("bold"),italic:i.includes("italic")}}function r(n,i){return n&&i?"bold italic":n?"bold":i?"italic":"normal"}function w(n,i){const k=i.currentTarget.value.slice(0,80);Se(n,{text:k})}function c(n,i){const k=Number(i.currentTarget.value);k>=2&&k<=18&&Se(n,{fontSizeMm:k})}function p(n,i){Se(n,{fill:i.currentTarget.value})}je();var l=ir(),P=f(l),S=M(f(P),2),T=f(S);v(S),v(P);var E=M(P,2),F=M(E,2);yt(F,1,s,n=>n.id,(n,i)=>{const k=ce(()=>(e(i),O(()=>d(e(i).fontStyle))));var G=ar(),A=f(G);Tt(A),ve(A,"maxlength",80);var R=M(A,2),N=f(R),I=M(f(N),2);Tt(I),ve(I,"min",2),ve(I,"max",18),ve(I,"step",.5),xt(2),v(N);var B=M(N,2),W=f(B);Tt(W);var _=M(W,2),Z=M(_,2);v(B),v(R),v(G),ge(()=>{Dt(A,(e(i),O(()=>e(i).text))),Dt(I,(e(i),O(()=>e(i).fontSizeMm))),Dt(W,(e(i),O(()=>e(i).fill))),_e(_,1,`grid h-7 w-7 place-items-center rounded-md text-xs font-bold transition
              ${z(e(k)),O(()=>e(k).bold?"bg-[var(--c-primary)] text-white":"border border-[var(--c-border)] bg-white text-slate-600 hover:bg-slate-50")??""}
              focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400`),ve(_,"aria-label",(z(e(k)),O(()=>e(k).bold?"Remover negrito":"Aplicar negrito"))),_e(Z,1,`grid h-7 w-7 place-items-center rounded-md text-xs transition
              ${z(e(k)),O(()=>e(k).italic?"bg-[var(--c-primary)] text-white":"border border-[var(--c-border)] bg-white text-slate-600 hover:bg-slate-50")??""}
              focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400`),ve(Z,"aria-label",(z(e(k)),O(()=>e(k).italic?"Remover itálico":"Aplicar itálico")))}),j("input",A,V=>w(e(i).id,V)),j("input",I,V=>c(e(i).id,V)),j("input",W,V=>p(e(i).id,V)),j("click",_,()=>Se(e(i).id,{fontStyle:r(!e(k).bold,e(k).italic)})),j("click",Z,()=>Se(e(i).id,{fontStyle:r(e(k).bold,!e(k).italic)})),q(n,G)}),v(l),ge(()=>{de(T,`${z(s()),O(()=>s().length)??""}/${h()??""}`),E.disabled=(z(s()),z(h()),O(()=>s().length>=h()))}),j("click",E,function(...n){y()?.apply(this,n)}),q(o,l),He()}var lr=Q('<button class="mt-2 w-full rounded-xl bg-[var(--c-primary)] px-3 py-2.5 text-sm font-semibold text-white transition hover:bg-[var(--c-primary-hover)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400" type="button">Aplicar foto ao slot</button>'),dr=Q('<label><input class="hidden" type="file" accept="image/*" multiple="" aria-label="Escolher arquivos de foto"/> <div class="grid h-10 w-10 shrink-0 place-items-center rounded-xl bg-slate-100 text-slate-500 transition group-hover:bg-orange-100 group-hover:text-[var(--c-accent)]"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 5v14" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path><path d="M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path></svg></div> <div class="min-w-0"><div class="text-sm font-medium text-[var(--c-text)]">Escolher arquivos</div> <div class="text-xs text-[var(--c-text-muted)]"> </div></div></label> <!>',1),cr=Q('<aside class="flex flex-col gap-3" aria-label="Painel de ferramentas"><!> <!> <!></aside>');function ur(o,t){Ne(t,!1);let s=u(t,"photos",24,()=>[]),h=u(t,"activePhotoAssetId",8,void 0),y=u(t,"selectedPhotoIds",24,()=>new Set),d=u(t,"uploadedCount",8,0),r=u(t,"totalSlots",8,0),w=u(t,"uploadRemaining",8,0),c=u(t,"textNodes",24,()=>[]),p=u(t,"activePhotoAssetIdForApply",8,void 0),l=u(t,"onPickPhoto",8,()=>{}),P=u(t,"onApplyPhoto",8,()=>{}),S=u(t,"onRemovePhoto",8,()=>{}),T=u(t,"onToggleSelect",8,()=>{}),E=u(t,"onToggleSelectAll",8,()=>{}),F=u(t,"onDeleteSelected",8,()=>{}),n=u(t,"onDuplicateSelected",8,()=>{}),i=u(t,"onApplyStyleSelected",8,()=>{}),k=u(t,"onApplySelectedPhotoToSlot",8,()=>{}),G=u(t,"onAddText",8,()=>{});je();var A=cr(),R=f(A);Et(R,{title:"Enviar Fotos",get badge(){return`${d()??""}/${r()??""}`},defaultOpen:!0,children:(B,W)=>{var _=dr(),Z=ye(_),V=f(Z),re=M(V,4),ee=M(f(re),2),he=f(ee);v(ee),v(re),v(Z);var Pe=M(Z,2);{var le=me=>{var Te=lr();j("click",Te,function(...ie){k()?.apply(this,ie)}),q(me,Te)};ke(Pe,me=>{p()&&me(le)})}ge(()=>{_e(Z,1,`group flex items-center gap-3 rounded-xl border-2 border-dashed p-3.5 transition
        ${w()>0?"border-slate-200 bg-white cursor-pointer hover:border-[var(--c-accent)] hover:bg-orange-50/30":"border-slate-100 bg-slate-50 cursor-not-allowed opacity-50"}`),V.disabled=w()<=0,de(he,`JPG, PNG, WEBP · até ${w()??""} foto${w()!==1?"s":""}`)}),j("change",V,function(...me){l()?.apply(this,me)}),q(B,_)},$$slots:{default:!0}});var N=M(R,2);Et(N,{title:"Suas Fotos",get badge(){return z(s()),O(()=>s().length)},defaultOpen:!0,children:(B,W)=>{nr(B,{get photos(){return s()},get activePhotoAssetId(){return h()},get selectedIds(){return y()},get onApply(){return P()},get onRemove(){return S()},get onToggleSelect(){return T()},get onToggleSelectAll(){return E()},get onDeleteSelected(){return F()},get onDuplicateSelected(){return n()},get onApplyStyleSelected(){return i()}})},$$slots:{default:!0}});var I=M(N,2);Et(I,{title:"Texto",get badge(){return`${z(c()),O(()=>c().length)??""}/4`},defaultOpen:!0,children:(B,W)=>{sr(B,{get textNodes(){return c()},maxTexts:4,get onAddText(){return G()}})},$$slots:{default:!0}}),v(A),q(o,A),He()}var vr=Q('<div class="flex items-center gap-2"><span class="text-sm font-semibold text-[var(--c-text)]"> </span> <div class="ml-auto flex items-center gap-1.5"><button class="grid h-8 w-8 place-items-center rounded-lg border border-[var(--c-border)] bg-white text-slate-700 transition enabled:hover:bg-slate-50 enabled:hover:border-[var(--c-border-strong)] disabled:opacity-40 disabled:cursor-not-allowed focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400" aria-label="Foto anterior" type="button"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button> <span class="min-w-[3.5rem] text-center text-xs tabular-nums text-[var(--c-text-muted)]"> </span> <button class="grid h-8 w-8 place-items-center rounded-lg border border-[var(--c-border)] bg-white text-slate-700 transition enabled:hover:bg-slate-50 enabled:hover:border-[var(--c-border-strong)] disabled:opacity-40 disabled:cursor-not-allowed focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400" aria-label="Próxima foto" type="button"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div>');function fr(o,t){Ne(t,!1);const s=C(),h=C(),y=C();let d=u(t,"currentIndex",8,0),r=u(t,"total",8,0),w=u(t,"onPrev",8,()=>{}),c=u(t,"onNext",8,()=>{});X(()=>z(d()),()=>{x(s,`Foto ${d()+1}`)}),X(()=>z(d()),()=>{x(h,d()>0)}),X(()=>(z(d()),z(r())),()=>{x(y,d()<r()-1)}),$e();var p=vr(),l=f(p),P=f(l,!0);v(l);var S=M(l,2),T=f(S),E=M(T,2),F=f(E);v(E);var n=M(E,2);v(S),v(p),ge(()=>{de(P,e(s)),T.disabled=!e(h),de(F,`${d()+1} / ${r()??""}`),n.disabled=!e(y)}),j("click",T,function(...i){w()?.apply(this,i)}),j("click",n,function(...i){c()?.apply(this,i)}),q(o,p),He()}var gr=Q("<!> <!> <!>",1),hr=Q("<!> <!>",1),pr=Q('<div class="grid place-items-center rounded-xl bg-white/60 p-2 ring-1 ring-[var(--c-border)] svelte-vfeg0k"><div class="canvas-polaroid-frame svelte-vfeg0k"><div class="overflow-hidden svelte-vfeg0k"><div class="svelte-vfeg0k"><!></div></div> <div class="relative bg-white svelte-vfeg0k"><div class="relative w-full h-full grid place-items-center svelte-vfeg0k"><div class="svelte-vfeg0k"><!></div></div></div></div></div>');function br(o,t){Ne(t,!1);let s=u(t,"StageCmp",8),h=u(t,"LayerCmp",8),y=u(t,"RectCmp",8),d=u(t,"ImageCmp",8),r=u(t,"TextCmp",8),w=u(t,"TransformerCmp",8),c=u(t,"layout",8),p=u(t,"activeSlotId",8),l=u(t,"stageWidthPx",8),P=u(t,"stageHeightPx",8),S=u(t,"stageScale",8),T=u(t,"stageScaledW",8),E=u(t,"photoScaledH",8),F=u(t,"captionScaledH",8),n=u(t,"captionTopPx",8),i=u(t,"captionAreaHpx",8),k=u(t,"photoAreaHpx",8),G=u(t,"dpi",8),A=C(),R=C(),N=!1;const I=new Map,B=new Set;let W=C(0);const _=.5,Z=6;function V(g){return mt(g,G())}function re(g){return be(Bo(g,G()))}function ee(g,L,b){return Math.max(L,Math.min(b,g))}function he(g){if(!g)return;const L=I.get(g);if(L)return L;if(B.has(g))return;B.add(g);const b=new Image;b.crossOrigin="anonymous",b.onload=()=>{I.set(g,b),B.delete(g),x(W,e(W)+1)},b.onerror=()=>{B.delete(g),x(W,e(W)+1)},b.src=g}function Pe(){if(!e(R)||!e(A))return;const g=io(Ye).selected?.nodeId,L=g?e(A).findOne(`#${g}`):null;e(R).nodes(L?[L]:[]),e(R).getLayer()?.batchDraw()}let le=null;function me(){le==null&&(le=requestAnimationFrame(()=>{le=null,Pe()}))}function Te(){if(N||!e(A))return;const g=e(A).container?.();if(!g)return;const L=b=>{b.preventDefault();const H=b.deltaY>0?.92:1.08,Y=ie(b.clientX,b.clientY);Y&&Me(Y,H)};g.addEventListener("wheel",L,{passive:!1}),N=!0,Rt(()=>g.removeEventListener("wheel",L))}function ie(g,L){if(!e(A))return null;const b=e(A).container?.().getBoundingClientRect?.();return b?{x:(g-b.left)/S(),y:(L-b.top)/S()}:null}function ne(){return c().nodes.find(g=>g.type==="photo"&&g.slotId===p())}function Me(g,L){const b=ne();if(!b)return;const H=b.scale??1,Y=ee(H*L,_,Z);if(Y===H)return;const te=V(b.xMm),oe=V(b.yMm),se=g.x-(g.x-te)*(Y/H),fe=g.y-(g.y-oe)*(Y/H);Se(b.id,{scale:be(Y),xMm:re(se),yMm:re(fe)})}let xe=null,ue=null;function De(g,L){return{x:(g.clientX+L.clientX)/2,y:(g.clientY+L.clientY)/2}}function Ve(g,L){const b=g.clientX-L.clientX,H=g.clientY-L.clientY;return Math.sqrt(b*b+H*H)}function wt(g){const L=g.evt;if(!L?.touches||L.touches.length!==2)return;L.preventDefault?.();const b=L.touches[0],H=L.touches[1],Y=Ve(b,H),te=De(b,H);if(xe==null||ue==null){xe=Y,ue=te;return}const oe=Y/xe,se=ie(te.x,te.y);se&&(Me(se,oe),xe=Y,ue=te)}function ut(g){const L=g.evt;(!L?.touches||L.touches.length<2)&&(xe=null,ue=null)}function vt(g){g.target===g.target.getStage()&&Ce(void 0,void 0)}function ft(g){return{draggable:!0,id:g.id,onClick:()=>Ce(g.slotId,g.id),onTap:()=>Ce(g.slotId,g.id),onDragMove:L=>{if(g.type!=="text")return;const b=L.target,H=b.width(),Y=b.height(),te=ee(b.x(),0,Math.max(0,l()-H)),oe=ee(b.y(),n(),Math.max(n(),P()-Y));te!==b.x()&&b.x(te),oe!==b.y()&&b.y(oe)},onDragEnd:L=>{if(g.type==="text"){const b=L.target,H=b.width(),Y=b.height(),te=ee(b.x(),0,Math.max(0,l()-H)),oe=ee(b.y(),n(),Math.max(n(),P()-Y));b.x(te),b.y(oe)}Se(g.id,{xMm:re(L.target.x()),yMm:re(L.target.y())})},onTransformEnd:L=>{const b=L.target,H=b.rotation(),Y=b.scaleX();b.scaleX(1),b.scaleY(1),g.type==="photo"?Se(g.id,{rotationDeg:H,scale:be(g.scale*Y),xMm:re(b.x()),yMm:re(b.y())}):Se(g.id,{rotationDeg:H,xMm:re(b.x()),yMm:re(b.y())})}}}function St(g){return{draggable:!0,id:g.id,onClick:()=>Ce(g.slotId,g.id),onTap:()=>Ce(g.slotId,g.id),dragBoundFunc(b){const H=this.getClientRect(),Y=H.x-this.x(),te=H.y-this.y();let oe=b.x,se=b.y;const fe=oe+Y,Oe=se+te,we=fe+H.width,Ie=Oe+H.height;return fe<8&&(oe+=8-fe),Oe<8&&(se+=8-Oe),we>l()-8&&(oe-=we-(l()-8)),Ie>i()-8&&(se-=Ie-(i()-8)),{x:oe,y:se}},onDragEnd:b=>{const H=b.target,Y=H.getClientRect(),te=Y.x,oe=Y.y,se=Y.x+Y.width,fe=Y.y+Y.height;te<8&&H.x(H.x()+(8-te)),oe<8&&H.y(H.y()+(8-oe)),se>l()-8&&H.x(H.x()-(se-(l()-8))),fe>i()-8&&H.y(H.y()-(fe-(i()-8))),Se(g.id,{xMm:re(H.x()),yMm:re(H.y()+n())})}}}Rt(()=>{le!=null&&cancelAnimationFrame(le)}),X(()=>z(s()),()=>{s()&&(me(),Te())}),$e(),je();var et=pr(),tt=f(et),Je=f(tt),ot=f(Je),kt=f(ot);Ee(kt,s,(g,L)=>{L(g,{get width(){return l()},get height(){return k()},style:"background: transparent",get konvaNode(){return e(A)},set konvaNode(b){x(A,b)},$$events:{mousedown:vt,touchstart:vt,touchmove:wt,touchend:ut,touchcancel:ut},children:(b,H)=>{var Y=qe(),te=ye(Y);Ee(te,h,(oe,se)=>{se(oe,{clipX:0,clipY:0,get clipWidth(){return l()},get clipHeight(){return k()},children:(fe,Oe)=>{var we=gr(),Ie=ye(we);Ee(Ie,y,(J,a)=>{a(J,{x:0,y:0,get width(){return l()},get height(){return k()},fill:"#ffffff"})});var Ge=M(Ie,2);yt(Ge,1,()=>(z(c()),z(p()),O(()=>c().nodes.filter(J=>J.slotId===p()&&J.type==="photo"))),J=>J.id,(J,a)=>{const m=ce(()=>(z(c()),e(a),O(()=>c().assets.photos.find(K=>K.id===e(a).assetId)))),U=ce(()=>(z(e(m)),O(()=>e(m)?.src?he(e(m).src):void 0)));var D=qe(),ae=ye(D);{var $=K=>{var ze=qe(),Ue=ye(ze);{let it=ce(()=>ft(e(a))),st=ce(()=>(e(a),O(()=>V(e(a).xMm)))),Ae=ce(()=>(e(a),O(()=>V(e(a).yMm)))),ht=ce(()=>(z(e(U)),O(()=>e(U).width/2))),Mt=ce(()=>(z(e(U)),O(()=>e(U).height/2)));Ee(Ue,d,(lt,Le)=>{Le(lt,Wt(()=>e(it),{get x(){return e(st)},get y(){return e(Ae)},get rotation(){return e(a),O(()=>e(a).rotationDeg)},get image(){return e(U)},get offsetX(){return e(ht)},get offsetY(){return e(Mt)},get scaleX(){return e(a),O(()=>e(a).scale)},get scaleY(){return e(a),O(()=>e(a).scale)}}))})}q(K,ze)};ke(ae,K=>{e(m)&&e(U)&&K($)})}q(J,D)});var pe=M(Ge,2);Ee(pe,w,(J,a)=>{a(J,{rotateEnabled:!0,enabledAnchors:["top-left","top-right","bottom-left","bottom-right"],boundBoxFunc:(m,U)=>U.width<8||U.height<8?m:U,get konvaNode(){return e(R)},set konvaNode(m){x(R,m)},$$legacy:!0})}),q(fe,we)},$$slots:{default:!0}})}),q(b,Y)},$$slots:{default:!0},$$legacy:!0})}),v(ot),v(Je);var rt=M(Je,2),nt=f(rt),at=f(nt),gt=f(at);Ee(gt,s,(g,L)=>{L(g,{get width(){return l()},get height(){return i()},style:"background: transparent",children:(b,H)=>{var Y=qe(),te=ye(Y);Ee(te,h,(oe,se)=>{se(oe,{children:(fe,Oe)=>{var we=hr(),Ie=ye(we);Ee(Ie,y,(pe,J)=>{J(pe,{x:0,y:0,get width(){return l()},get height(){return i()},fill:"#ffffff",listening:!1})});var Ge=M(Ie,2);yt(Ge,1,()=>(z(c()),z(p()),O(()=>c().nodes.filter(pe=>pe.slotId===p()&&pe.type==="text"))),pe=>pe.id,(pe,J)=>{var a=qe(),m=ye(a);{let U=ce(()=>St(e(J))),D=ce(()=>(e(J),O(()=>V(e(J).xMm)))),ae=ce(()=>(e(J),z(n()),O(()=>V(e(J).yMm)-n()))),$=ce(()=>(e(J),O(()=>V(e(J).fontSizeMm)))),K=ce(()=>(e(J),O(()=>e(J).fontStyle??"normal")));Ee(m,r,(ze,Ue)=>{Ue(ze,Wt(()=>e(U),{get x(){return e(D)},get y(){return e(ae)},get rotation(){return e(J),O(()=>e(J).rotationDeg)},get text(){return e(J),O(()=>e(J).text)},get fontFamily(){return e(J),O(()=>e(J).fontFamily)},get fontSize(){return e($)},get fill(){return e(J),O(()=>e(J).fill)},get fontStyle(){return e(K)}}))})}q(pe,a)}),q(fe,we)},$$slots:{default:!0}})}),q(b,Y)},$$slots:{default:!0}})}),v(at),v(nt),v(rt),v(tt),v(et),ge(()=>{Ze(Je,`width:${T()??""}px; height:${E()??""}px;`),Ze(ot,`transform: scale(${S()??""}); transform-origin: top left; width:${l()??""}px; height:${k()??""}px;`),Ze(rt,`width:${T()??""}px; height:${F()??""}px;`),Ze(at,`transform: scale(${S()??""}); transform-origin: top left; width:${l()??""}px; height:${i()??""}px;`)}),q(o,et),He()}var mr=Q('<div id="finalize-tooltip" role="tooltip" class="pointer-events-none absolute bottom-full right-0 mb-2 w-48 rounded-lg bg-slate-900 px-3 py-2 text-xs text-white opacity-0 shadow-lg transition-opacity group-hover:opacity-100"> <div class="absolute -bottom-1 right-4 h-2 w-2 rotate-45 bg-slate-900"></div></div>'),xr=Q('<div class="fixed inset-x-0 bottom-0 z-50 border-t border-[var(--c-border)] bg-white/80 backdrop-blur-lg"><div class="mx-auto flex max-w-7xl items-center gap-3 px-4 py-3"><div class="flex items-center gap-3 min-w-0"><div class="hidden sm:block h-1.5 w-32 overflow-hidden rounded-full bg-slate-100"><div></div></div> <span class="text-sm text-[var(--c-text-muted)] whitespace-nowrap"><span class="font-semibold tabular-nums text-[var(--c-text)]"> </span> preenchidas</span></div> <div class="ml-auto flex items-center gap-2"><button class="rounded-xl border border-[var(--c-border-strong)] bg-white px-4 py-2 text-sm font-semibold transition hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400" type="button">Voltar</button> <div class="relative group"><button type="button">Finalizar Pedido</button> <!></div></div></div></div>');function yr(o,t){Ne(t,!1);const s=C(),h=C(),y=C();let d=u(t,"filledCount",8,0),r=u(t,"totalSlots",8,0),w=u(t,"onBack",8,()=>{}),c=u(t,"onFinalize",8,()=>{});X(()=>(z(r()),z(d())),()=>{x(s,Math.max(0,r()-d()))}),X(()=>(e(s),z(r())),()=>{x(h,e(s)===0&&r()>0)}),X(()=>(z(r()),z(d())),()=>{x(y,r()>0?Math.round(d()/r()*100):0)}),$e();var p=xr(),l=f(p),P=f(l),S=f(P),T=f(S);v(S);var E=M(S,2),F=f(E),n=f(F);v(F),xt(),v(E),v(P);var i=M(P,2),k=f(i),G=M(k,2),A=f(G),R=M(A,2);{var N=I=>{var B=mr(),W=f(B);xt(),v(B),ge(()=>de(W,`Preencha todas as ${r()??""} fotos para finalizar `)),q(I,B)};ke(R,I=>{e(h)||I(N)})}v(G),v(i),v(l),v(p),ge(()=>{_e(T,1,`h-full rounded-full transition-all duration-300 ${e(h)?"bg-emerald-500":"bg-[var(--c-accent)]"}`),Ze(T,`width: ${e(y)??""}%`),de(n,`${d()??""}/${r()??""}`),_e(A,1,`rounded-xl px-4 py-2 text-sm font-semibold transition focus-visible:outline-none focus-visible:ring-2
            ${e(h)?"bg-[var(--c-primary)] text-white hover:bg-[var(--c-primary-hover)] focus-visible:ring-slate-400":"bg-slate-100 text-slate-400 cursor-not-allowed"}`),A.disabled=!e(h),ve(A,"aria-describedby",e(h)?void 0:"finalize-tooltip")}),j("click",k,function(...I){w()?.apply(this,I)}),j("click",A,function(...I){c()?.apply(this,I)}),q(o,p),He()}var _r=Q('<div class="fixed inset-0 z-[100] grid place-items-center p-4" role="dialog" aria-modal="true" aria-labelledby="confirm-dialog-title"><button class="absolute inset-0 bg-black/30 backdrop-blur-sm" aria-label="Fechar diálogo" type="button" tabindex="-1"></button> <div class="relative w-full max-w-md rounded-2xl bg-white p-6 shadow-[var(--shadow-modal)]"><div class="flex items-start gap-3"><div><svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M12 9v4" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path><path d="M12 17h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path><path d="M10.3 4.2 2.6 18a2 2 0 0 0 1.7 3h15.4a2 2 0 0 0 1.7-3L13.7 4.2a2 2 0 0 0-3.4 0Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path></svg></div> <div class="flex-1 min-w-0"><h2 id="confirm-dialog-title" class="text-base font-semibold leading-tight"> </h2> <p class="mt-1.5 text-sm text-[var(--c-text-muted)] leading-relaxed"> </p></div></div> <div class="mt-5 flex gap-2"><button class="flex-1 rounded-xl border border-[var(--c-border-strong)] bg-white px-4 py-2.5 text-sm font-semibold transition hover:bg-slate-50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400" type="button"> </button> <button type="button"> </button></div></div></div>');function Gt(o,t){Ne(t,!1);let s=u(t,"open",8,!1),h=u(t,"title",8,"Confirmar"),y=u(t,"message",8,""),d=u(t,"confirmLabel",8,"Confirmar"),r=u(t,"cancelLabel",8,"Cancelar"),w=u(t,"variant",8,"default"),c=u(t,"onConfirm",8,()=>{}),p=u(t,"onCancel",8,()=>{});function l(E){E.key==="Escape"&&p()()}je();var P=qe();j("keydown",Co,l);var S=ye(P);{var T=E=>{var F=_r(),n=f(F),i=M(n,2),k=f(i),G=f(k),A=M(G,2),R=f(A),N=f(R,!0);v(R);var I=M(R,2),B=f(I,!0);v(I),v(A),v(k);var W=M(k,2),_=f(W),Z=f(_,!0);v(_);var V=M(_,2),re=f(V,!0);v(V),v(W),v(i),v(F),ge(()=>{_e(G,1,`grid h-10 w-10 shrink-0 place-items-center rounded-xl ${w()==="danger"?"bg-red-100 text-red-600":"bg-slate-100 text-slate-700"}`),de(N,h()),de(B,y()),de(Z,r()),_e(V,1,`flex-1 rounded-xl px-4 py-2.5 text-sm font-semibold text-white transition focus-visible:outline-none focus-visible:ring-2 ${w()==="danger"?"bg-[var(--c-danger)] hover:bg-[var(--c-danger-hover)] focus-visible:ring-red-400":"bg-[var(--c-primary)] hover:bg-[var(--c-primary-hover)] focus-visible:ring-slate-400"}`),de(re,d())}),j("click",n,function(...ee){p()?.apply(this,ee)}),j("click",_,function(...ee){p()?.apply(this,ee)}),j("click",V,function(...ee){c()?.apply(this,ee)}),We(3,i,()=>Eo,()=>({start:.96,duration:140})),We(1,F,()=>Ht,()=>({duration:120})),We(2,F,()=>Ht,()=>({duration:100})),q(E,F)};ke(S,E=>{s()&&E(T)})}q(o,P),He()}var wr=Q('<link rel="preconnect" href="https://fonts.googleapis.com"/> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/> <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;family=Pacifico&amp;display=swap" rel="stylesheet"/>',1),Sr=Q('<div class="rounded-2xl border border-[var(--c-border)] bg-[var(--c-surface)] p-3 shadow-[var(--shadow-card)] backdrop-blur"><div class="mb-3"><!></div> <!></div>'),kr=Q('<div class="grid min-h-screen place-items-center bg-[var(--c-bg)]"><div class="flex flex-col items-center gap-3"><div class="h-8 w-8 animate-spin rounded-full border-2 border-slate-300 border-t-slate-600"></div> <p class="text-sm text-[var(--c-text-muted)]">Carregando editor…</p></div></div>'),Mr=Q("<!> <!> <!>",1);function Or(o,t){Ne(t,!1);const s=()=>Ut(Ye,"$layoutStore",y),h=()=>Ut(Fo,"$page",y),[y,d]=oo(),r=C(),w=C(),c=C(),p=C(),l=C(),P=C(),S=C(),T=C(),E=C(),F=C(),n=C(),i=C(),k=C(),G=C(),A=C(),R=C(),N=C(),I=C(),B=C(),W=C(),_=C(),Z=C(),V=C(),re=C();let ee=C(),he=C(),Pe=C(),le=C(),me=C(),Te=C(),ie=C(),ne=C(new Set),Me=C(!1),xe=C(!1),ue=C(1200),De=C();const Ve=20;function wt(a){return mt(a,e(w))}const ut=560,vt=.82,ft=18,St=634/710;async function et(){const a=await ro(()=>import("../chunks/C09ilbkJ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url);x(ee,a.Stage),x(he,a.Layer),x(Pe,a.Rect),x(le,a.Image),x(me,a.Text),x(Te,a.Transformer)}so(()=>{const a=()=>{x(ue,window.innerWidth)};return a(),window.addEventListener("resize",a),et(),()=>window.removeEventListener("resize",a)});function tt(){x(Me,!0)}function Je(){x(Me,!1)}function ot(){x(Me,!1),Do("/")}function kt(){const a=Math.max(0,e(P)-1);Ce(e(r).slots[a].id,void 0)}function rt(){const a=Math.min(e(r).slots.length-1,e(P)+1);Ce(e(r).slots[a].id,void 0)}function nt(){const a=e(r).selected?.slotId??e(r).slots[0]?.id;if(!a||!e(ie))return;const m=e(r).slots.find(K=>K.id===a);if(!m)return;const U=e(r).nodes.find(K=>K.type==="photo"&&K.slotId===a);if(U){Se(U.id,{assetId:e(ie)}),Ce(a,U.id);return}const D=Be(),ae=Math.max(1,m.heightMm-Ve),$={id:Qe(),type:"photo",origin:"center",slotId:a,assetId:e(ie),xMm:be(m.xMm+m.widthMm/2),yMm:be(m.yMm+ae/2),rotationDeg:0,scale:1};Ke({...D,nodes:[...D.nodes,$],selected:{slotId:a,nodeId:$.id}})}function at(a){x(ie,a),nt()}function gt(a){const m=Be(),U=m.assets.photos.find(D=>D.id===a);if(U?.src?.startsWith("blob:")&&URL.revokeObjectURL(U.src),m.assets.photos=m.assets.photos.filter(D=>D.id!==a),m.nodes=m.nodes.filter(D=>!(D.type==="photo"&&D.assetId===a)),e(ie)===a&&x(ie,void 0),e(ne).has(a)){const D=new Set(e(ne));D.delete(a),x(ne,D)}Ke(m)}function g(a){const m=new Set(e(ne));m.has(a)?m.delete(a):m.add(a),x(ne,m)}function L(){const a=e(r).assets.photos.map(m=>m.id);a.length===0||e(ne).size===a.length?x(ne,new Set):x(ne,new Set(a))}function b(){const a=Be(),m=Array.from(e(ne));if(m.length===0)return;const U=new Set;for(const D of m){const ae=a.assets.photos.find(K=>K.id===D);if(!ae)continue;const $=Xo({src:ae.src,name:ae.name?`${ae.name} (cópia)`:"Cópia"});U.add($),x(ie,$)}x(ne,U)}function H(){const a=Array.from(e(ne));if(a.length!==0){for(const m of a)gt(m);x(ne,new Set)}}function Y(){const a=Be(),m=a.selected?.slotId??a.slots[0]?.id;if(!m)return;const U=a.nodes.find($=>$.type==="photo"&&$.slotId===m);if(!U)return;const D=new Set(e(ne)),ae=a.nodes.map($=>{if($.type!=="photo")return $;const K=$;return D.has(K.assetId)?{...K,rotationDeg:U.rotationDeg,scale:U.scale}:$});Ke({...a,nodes:ae})}async function te(a){const m=a.target,U=Array.from(m.files??[]);if(U.length===0)return;const D=Be(),ae=D.selected?.slotId?Math.max(0,D.slots.findIndex(Ae=>Ae.id===D.selected?.slotId)):0,$=Math.max(0,D.slots.length-D.assets.photos.length),K=U.slice(0,$);if(K.length===0){m.value="";return}const ze=[...D.nodes];let Ue,it,st;for(let Ae=0;Ae<K.length;Ae++){const ht=K[Ae],Mt=URL.createObjectURL(ht),lt=Qe();D.assets.photos.push({id:lt,src:Mt,name:ht.name});const Le=D.slots[ae+Ae]??D.slots[0];if(!Le)continue;const to=Math.max(1,Le.heightMm-Ve);Ae===0&&(Ue=lt,st=Le.id);const Bt={id:Qe(),type:"photo",origin:"center",slotId:Le.id,assetId:lt,xMm:be(Le.xMm+Le.widthMm/2),yMm:be(Le.yMm+to/2),rotationDeg:0,scale:1};Ae===0&&(it=Bt.id),ze.push(Bt)}Ue&&x(ie,Ue),Ke(st&&it?{...D,nodes:ze,selected:{slotId:st,nodeId:it}}:{...D,nodes:ze}),m.value=""}function oe(){const a=Be(),m=a.selected?.slotId??a.slots[0]?.id;if(!m||a.nodes.filter(K=>K.type==="text"&&K.slotId===m).length>=4)return;const D=a.slots.find(K=>K.id===m);if(!D)return;const ae=a.template.stage.heightMm-Ve,$={id:Qe(),type:"text",origin:"topleft",slotId:m,text:"Novo Texto",xMm:be(D.xMm+D.widthMm*.28),yMm:be(D.yMm+ae+5),rotationDeg:0,fontFamily:"Pacifico",fontSizeMm:3,fill:"#111111",fontStyle:"normal"};Ke({...a,nodes:[...a.nodes,$],selected:{slotId:m,nodeId:$.id}})}function se(){x(xe,!0)}function fe(){const a=Be(),m=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),U=URL.createObjectURL(m),D=document.createElement("a");D.href=U,D.download=`pedido-${e(l)}.json`,D.click(),URL.revokeObjectURL(U),x(xe,!1)}Rt(()=>{const a=Be();for(const m of a.assets.photos)m.src.startsWith("blob:")&&URL.revokeObjectURL(m.src)}),X(()=>s(),()=>{x(r,s())}),X(()=>e(r),()=>{x(w,e(r).dpi)}),X(()=>(e(r),e(w)),()=>{x(c,Math.round(mt(e(r).template.stage.widthMm,e(w))))}),X(()=>(e(r),e(w)),()=>{x(p,Math.round(mt(e(r).template.stage.heightMm,e(w))))}),X(()=>h(),()=>{x(l,h().params.id)}),X(()=>e(r),()=>{x(P,e(r).selected?.slotId?Math.max(0,e(r).slots.findIndex(a=>a.id===e(r).selected?.slotId)):0)}),X(()=>e(r),()=>{x(S,e(r).slots.length)}),X(()=>e(r),()=>{x(T,e(r).assets.photos.length)}),X(()=>e(r),()=>{x(E,new Set(e(r).nodes.filter(a=>a.type==="photo").map(a=>a.slotId)).size)}),X(()=>(e(S),e(T)),()=>{x(F,Math.max(0,e(S)-e(T)))}),X(()=>e(r),()=>{x(n,e(r).selected?.slotId??e(r).slots[0]?.id)}),X(()=>(e(r),e(n)),()=>{x(i,e(r).nodes.filter(a=>a.type==="text"&&a.slotId===e(n)).slice(0,4))}),X(()=>{},()=>{x(k,wt(Ve))}),X(()=>(e(p),e(k)),()=>{x(G,Math.max(0,e(p)-e(k)))}),X(()=>e(G),()=>{x(A,e(G))}),X(()=>e(k),()=>{x(R,e(k))}),X(()=>e(ue),()=>{x(N,Math.min(ut,Math.round(e(ue)*vt)))}),X(()=>e(N),()=>{x(I,Math.round(e(N)/St))}),X(()=>e(N),()=>{x(B,e(N)-ft*2)}),X(()=>e(I),()=>{x(W,e(I)-ft*2)}),X(()=>(e(B),e(c),e(W),e(p)),()=>{x(_,Math.min(e(B)/e(c),e(W)/e(p)))}),X(()=>(e(c),e(_)),()=>{x(Z,Math.floor(e(c)*e(_)))}),X(()=>(e(A),e(_)),()=>{x(V,Math.floor(e(A)*e(_)))}),X(()=>(e(R),e(_)),()=>{x(re,Math.floor(e(R)*e(_)))}),X(()=>(e(r),Ce),()=>{e(r).slots.length>0&&!e(r).selected?.slotId&&queueMicrotask(()=>Ce(e(r).slots[0].id,void 0))}),X(()=>(e(n),e(De),e(r)),()=>{if(e(n)&&e(n)!==e(De)){x(De,e(n));const a=e(r).nodes.find(m=>m.type==="photo"&&m.slotId===e(n));x(ie,a?.assetId)}}),$e(),je();var Oe=Mr();Po("1rxvg2y",a=>{var m=wr();xt(4),q(a,m)});var we=ye(Oe);{var Ie=a=>{Yo(a,{get orderId(){return e(l)},get currentSlotIndex(){return e(P)},get totalSlots(){return e(S)},onBack:tt,$$slots:{sidebar:(m,U)=>{ur(m,{get photos(){return e(r),O(()=>e(r).assets.photos)},get activePhotoAssetId(){return e(ie)},get selectedPhotoIds(){return e(ne)},get uploadedCount(){return e(T)},get totalSlots(){return e(S)},get uploadRemaining(){return e(F)},get textNodes(){return e(i)},get activePhotoAssetIdForApply(){return e(ie)},onPickPhoto:te,onApplyPhoto:at,onRemovePhoto:gt,onToggleSelect:g,onToggleSelectAll:L,onDeleteSelected:H,onDuplicateSelected:b,onApplyStyleSelected:Y,onApplySelectedPhotoToSlot:nt,onAddText:oe})},canvas:(m,U)=>{var D=Sr(),ae=f(D),$=f(ae);fr($,{get currentIndex(){return e(P)},get total(){return e(S)},onPrev:kt,onNext:rt}),v(ae);var K=M(ae,2);br(K,{get StageCmp(){return e(ee)},get LayerCmp(){return e(he)},get RectCmp(){return e(Pe)},get ImageCmp(){return e(le)},get TextCmp(){return e(me)},get TransformerCmp(){return e(Te)},get layout(){return e(r)},get activeSlotId(){return e(n)},get stageWidthPx(){return e(c)},get stageHeightPx(){return e(p)},get stageScale(){return e(_)},get stageScaledW(){return e(Z)},get photoScaledH(){return e(V)},get captionScaledH(){return e(re)},get captionTopPx(){return e(G)},get captionAreaHpx(){return e(R)},get photoAreaHpx(){return e(A)},get dpi(){return e(w)}}),v(D),q(m,D)},bottombar:(m,U)=>{yr(m,{get filledCount(){return e(E)},get totalSlots(){return e(S)},onBack:tt,onFinalize:se})}}})},Ge=a=>{var m=kr();q(a,m)};ke(we,a=>{e(ee)?a(Ie):a(Ge,!1)})}var pe=M(we,2);Gt(pe,{get open(){return e(Me)},title:"Voltar para a tela do pedido?",message:"Se você voltar agora, suas alterações continuarão aqui enquanto a página estiver aberta, mas você pode perder o que não exportou.",confirmLabel:"Sim, voltar",cancelLabel:"Cancelar",onConfirm:ot,onCancel:Je});var J=M(pe,2);Gt(J,{get open(){return e(xe)},title:"Finalizar Pedido",message:"O pedido está completo! Por enquanto, você pode baixar o layout como arquivo JSON. Integração com backend será adicionada em breve.",confirmLabel:"Baixar JSON",cancelLabel:"Fechar",onConfirm:fe,onCancel:()=>x(xe,!1)}),q(o,Oe),He(),d()}export{Or as component,Hr as universal};
